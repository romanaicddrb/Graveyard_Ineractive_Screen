<!DOCTYPE html>
<html lang="en" style="scroll-behavior:smooth" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">

  <title>Graveyard interactive screen</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=Hind Siliguri' rel='stylesheet'>


  <link th:href="@{/resource/CSS/main.css}" rel="stylesheet">
  <link th:href="@{/resource/CSS/graveSearchWithFilter.css}" rel="stylesheet">

  <script type="module" th:href="@{/js/graveSearchWithFilter.js}"></script>
  <script type="text/javascript" th:href="@{/resource/JS/graveSearchWithFilter.js}"></script>
</head>
<body>
  <div th:replace="CommonTemp/navBar.html :: navbar"></div>
  <main role="main" class="overflow-hidden"
        style="margin-top: 98px; padding: 0 1%;">
    <div class="row gx-5">
      <div id="bg-top">
        <div class="video-background" style="margin-top: -20px;">
          <div class="bg">
            <img th:src="@{/resource/image/graveSearchWithfilterBG.jpg}" alt="BG">
          </div>
        </div>
      </div>

      <div class="row" style="padding: 0px;margin: 1% 0px;margin-top: 2%;">
        <ol class="breadcrumb" style="background: none; color: white; padding: 0 1rem; margin: 0px;">
          <li class="breadcrumb-item">
            <a class="active-2" th:href="@{/}" style="display: inline;">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.90727 8.33332L9.90837 3.33222L14.9095 8.33332H14.9084V16.6667H4.90839V8.33332H4.90727ZM3.24172 9.99887L2.01104 11.2296L0.833374 10.0519L8.73086 2.1544C9.38118 1.50408 10.4356 1.50408 11.0859 2.1544L18.9834 10.0519L17.8057 11.2296L16.5751 9.99889V16.6667C16.5751 17.5871 15.8289 18.3333 14.9084 18.3333H4.90839C3.98791 18.3333 3.24172 17.5871 3.24172 16.6667V9.99887Z" fill="white"/>
              </svg>
              <p style="color: white; display: inline; cursor: pointer;">হোম</p>
            </a>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M13.9226 3.92259L12.7441 2.74408L5.48817 10L12.7441 17.2559L13.9226 16.0774L7.8452 10L13.9226 3.92259Z" fill="#D1D5DB"/>
            </svg>
            <a class="active-2" href="#" style="display: inline;">
              <p style="color: white; display: inline; cursor: pointer;">কবর অনুসন্ধান</p>
            </a>
          </li>

        </ol>
      </div>
    </div>

    <div class="row" style="height: 100%;">
    <!-- Left Card with Filter Options -->

      <div class="col-md-4">
      <div class="card"
           style="padding: 20px; padding-left: 40px; padding-right: 40px; padding-bottom: 70px;
           border-radius: 20px; background: #FFF; height: 100%;">
        <div>
          <p style="color: #205F8B; font-family: Hind Siliguri; font-size: 30px; font-style: normal;
              font-weight: 500; line-height: normal; margin: auto; align-content: center; padding: 20px 0px;
              display: flex; align-items: center;">
            প্রয়োজনীয় তথ্য দিয়ে অনুসন্ধান করুন
          </p>
        </div>
        <div class="card-body"
             style="display: flex; flex-direction: column; align-items: flex-start; padding: 50px;
                    font-family: Hind Siliguri; font-size: 22px; border-radius: 10px; padding-bottom: 60px; background: #EBEBEB;">
          <div class="row" style="gap: 20px;">
            <div class="col-md-12">
              <div class="form-group">
                <label for="MemoFilter">মেমো নম্বর</label>
                <input type="text" class="form-control" id="MemoFilter">
              </div>
            </div>


            <div class="col-md-12">
              <div class="form-group">
                <label for="DeadnameFilter">মৃত ব্যক্তির নাম</label>
                <input type="text" class="form-control" id="DeadnameFilter">
              </div>
            </div>


            <div class="col-md-12">
              <div class="form-group">
                <label for="DeaddayFilter">মৃত্যুর তারিখ</label>
                <div class="row">
                  <div class="col-sm-4">
                    <div class="form-group">
                      <select class="form-control" id="DeaddayFilter" >
                        <option value="" disabled selected>দিন</option>
                        <!-- Add more day options as needed -->
                      </select>
                    </div>
                  </div>

                  <div class="col-sm-4">
                    <div class="form-group">
                      <select class="form-control" id="DeadmonthFilter" >
                        <option value="" selected>মাস</option>
                        <!-- Add more month options as needed -->
                      </select>
                    </div>
                  </div>

                  <div class="col-sm-4">
                    <div class="form-group">

                        <select class="form-control" id="DeadyearFilter">
                          <option value="" selected>সাল</option>
                          <!-- Add more year options as needed -->
                        </select>

                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="col-md-12">
              <div class="form-group">
                <label for="BurieddayFilter">দাফনের তারিখ</label>
                <div class="row">
                  <div class="col-sm-4">
                    <div class="form-group">
                      <select class="form-control" id="BurieddayFilter" >
                        <option value="" disabled selected>দিন</option>
                      </select>
                    </div>
                  </div>

                  <div class="col-sm-4">
                    <div class="form-group">
                      <select class="form-control" id="BuriedmonthFilter" >
                        <option value="" selected>মাস</option>
                        <!-- Add more month options as needed -->
                      </select>
                    </div>
                  </div>

                  <div class="col-sm-4">
                    <div class="form-group">
                      <select class="form-control" id="BuriedyearFilter" >
                        <option value="" selected>সাল</option>
                        <!-- Add more year options as needed -->
                      </select>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-12" style="margin-top: 10px;">
              <button id="searchBtn" type="button" class="btn"
                      style="width: 100%; background-color: #205F8B;">
                <svg xmlns="http://www.w3.org/2000/svg" width="31" height="30" viewBox="0 0 31 30" fill="none">
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M13 22.5C7.47715 22.5 3 18.0228 3 12.5C3 6.97715 7.47715 2.5 13 2.5C18.5228 2.5 23 6.97715 23 12.5C23 14.8109 22.2161 16.9387 20.8998 18.6321L27.6339 25.3661L25.8661 27.1339L19.1321 20.3998C17.4387 21.7161 15.3109 22.5 13 22.5ZM20.5 12.5C20.5 16.6421 17.1421 20 13 20C8.85786 20 5.5 16.6421 5.5 12.5C5.5 8.35786 8.85786 5 13 5C17.1421 5 20.5 8.35786 20.5 12.5Z" fill="white"/>
                </svg>
              </button>
            </div>

            <div class="col-md-12">
              <label id="filterFieldEmpty"
                     style="color:red; display: block; text-align: center; margin-bottom: -15px;">
              </label>
            </div>
        </div>
        </div>
      </div>
    </div>

      <!-- Right Card with Data Table -->
      <div class="col-md-8">
      <div class="card" style="height: 100%; border-radius: 20px;">

        <div class="card-body table-responsive" style="padding: 0px 20px 20px 20px;">
          <!-- DataTable style="background: #E1EFFE; border-radius: 20px 20px 0px 0px;"-->
          <table class="table align-middle" id="myDataTable"
                 style="width: 100%;">
            <thead>
              <tr>
                <th style="display:none">Id</th>
                <th style="display:none">GraveId</th>
                <th>মেমো নম্বর</th>
                <th>মৃত্যুর তারিখ</th>
                <th>মৃত ব্যক্তির নাম</th>
                <th>পিতার নাম</th>
                <th>দাফনের তারিখ</th>
                <th>ঠিকানা</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="display:none"></td>
                <td style="display:none"></td>
                <td></td>
                <td></td>
                <td></td>
                <td style="display:none"></td>
                <td style="display:none"></td>
                <td style="display:none"></td>
                <td style="display:none"></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
    </div>

    <div class="loader-wrapper">
      <span class="loader"><span class="loader-inner"></span></span>
    </div>
  </main>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="/plugins/jquery/jquery.min.js"></script>
<script src="/plugins/datatables/jquery.datatables.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.8.4/moment.min.js"></script>

<script type="text/javascript" src="//cdn.datatables.net/plug-ins/1.10.24/dataRender/datetime.js"></script>
<script type="module" th:href="@{/js/graveSearchWithFilter.js}"></script>
<script type="text/javascript" th:href="@{/resource/JS/graveSearchWithFilter.js}"></script>
  <script>
    $(window).on("load",function(){
           $(".loader-wrapper").fadeOut("slow");
    });

     $(document).ready(function(){
                var gidValue = '2';
                $('#myDataTable').DataTable().clear().destroy();
                var myDataTable = $('#myDataTable').DataTable({
                    language: {
                        "emptyTable": "<img src='../resource/image/nodata.png' style='position: fixed; z-index: 1000; margin-left: 60%;'>",
                        "lengthMenu": "Show _MENU_ entries",
                        "info": "Showing _START_ to _END_ of _TOTAL_ entries",
                        "infoEmpty": "Showing 0 to 0 of 0 entries",
                        "search": "Search:",
                        "paginate": {
                            "first": "First",
                            "last": "Last",
                            "next": "Next",
                            "previous": "Previous"
                        }
                    },
                    "responsive": true,
                    "lengthChange": false,
                    "autoWidth": true,
                    "paging": true,
                    "scrollCollapse": true,
                    "scrollX": true,
                    "scrollY": 685,
                    "sDom": '<"row view-filter"<"col-sm-12"<"pull-left"l><"pull-right"f><"clearfix">>>t<"row view-pager"<"col-sm-12"<"text-center"ip>>>',

                    "fixedHeader": true,
                    "select": true,
                    "processing": false,
                    "destroy": true,
                    "orderable": true,

                    columns: [
                      { data: 'dec_id', visible: false, width: '0%'},
                      { data: 'graveyard_id' , visible: false, width: '0%' },
                      { data: 'memo_no', width: '100px' },
                      { data: 'dod', width: '140px', },
                      { data: 'dec_name' },
                      { data: 'father', },
                      { data: 'bur_date', width: '160px', },

                      { data: 'address' , visible: false, width: '0%' },
                      {
                            data: null,
                            render: function (data, type, row) {
                                if (data && data.dec_id && data.graveyard_id) {
                                  return '<div class="mr-3" style="margin-left: -5%; font-size: 5px; display: flex; align-items: center;"><button type="button" class="btn btn-block btn-sm"> বিস্তারিত দেখুন </button></div>';
                                }
                                else {
                                    // If data is not available, return an empty string
                                    return '';
                                }
                            }, width: '140px'
                        }
                    ],
                    "columnDefs": [
                        {
                          "targets": [4, 5], // Column indexes (0-based) where transformation should be applied
                          "render": function (data, type, row) {
                              // Apply text-transform: uppercase to the rendered content
                              return type === 'display' && data !== null ? data.toUpperCase() : data;
                          }
                        },

                        {
                          "targets": [3, 6],
                          "type": "datetime", render: $.fn.dataTable.render.moment( 'DD-MM-YYYY' ) },

                    ],
                });
                function loadDetailsPage(dec_id, graveyard_id) {
                        window.location.href = '/graveDetails_withPosition?id=' + dec_id + '&gid=' + graveyard_id;
                }

              $('#searchBtn').on('click', function() {
                   var memoFilter = $('#MemoFilter').val();
                   var deadNameFilter = $('#DeadnameFilter').val();
                   var deadDayFilter = $('#DeaddayFilter').val();
                   var deadMonthFilter = $('#DeadmonthFilter').val();
                   var deadYearFilter = $('#DeadyearFilter').val();
                   var buriedDayFilter = $('#BurieddayFilter').val();
                   var buriedMonthFilter = $('#BuriedmonthFilter').val();
                   var buriedYearFilter = $('#BuriedyearFilter').val();
  <!--                 console.log(memoFilter);-->
  <!--                 console.log(deadNameFilter);-->
  <!--                 console.log(deadDayFilter);-->
  <!--                 console.log(deadMonthFilter);-->
  <!--                 console.log(deadYearFilter);-->
  <!--                 console.log(buriedDayFilter);-->
  <!--                 console.log(buriedMonthFilter);-->
  <!--                 console.log(buriedYearFilter);-->

  if(memoFilter!="" || deadNameFilter!="" || deadDayFilter!=null || deadMonthFilter!="" ||
  deadYearFilter!="" || buriedDayFilter!=null || buriedMonthFilter!="" || buriedYearFilter!=""){
                   // Prepare the request data
                   var requestData = {
                      graveyardId: '2',
                      memo: memoFilter,
                      name: deadNameFilter,
                      dod_day: '',
                      dod_month: deadMonthFilter,
                      dod_year: deadYearFilter,
                      bur_day: '',
                      bur_month: buriedMonthFilter,
                      bur_year: buriedYearFilter
                   };


                    $.ajax({
                      url: '/api/search',
                      method: 'POST',
                      destroy : true,
                      contentType: 'application/json',
                      data: JSON.stringify(requestData),
                      success: function(data) {
  <!--                        console.log(data)-->
                          myDataTable.clear();
                          if (data.data.length > 0) {
                            myDataTable.rows.add(data.data).draw();
                            $('.btn').on('click', function() {
                                var rowData = myDataTable.row($(this).parents('tr')).data();
                                loadDetailsPage(rowData.dec_id,rowData.graveyard_id);
                            });
                          } else {
                            myDataTable.clear().draw();
                            //myDataTable.rows.add( "" ).draw();
                          }
                      },
                      error: function(error) {
                        console.error('Error performing search:', error);
                      }
                    });
      }else {$('#filterFieldEmpty').text("Please fill at-least one filter field");}
              });


  <!--            var table = $('#myDataTable').DataTable({-->
  <!--                ajax: '/test/0',-->
  <!--                'processing': true,-->
  <!--                'language': {-->
  <!--                    'loadingRecords': '&nbsp;',-->
  <!--                    'processing': 'Loading...'-->
  <!--                }-->
  <!--            });-->

  <!--            $('#searchBtn').on('click', function(){-->
  <!--                table.ajax.reload();-->
  <!--            });-->



     });



    const monthDropDown = document.getElementById("BuriedmonthFilter");
    const monthDropDownDead = document.getElementById("DeadmonthFilter");
    const monthData = {
  <!--    "জানুয়ারি": "01",-->
  <!--    "ফেব্রুয়ারি": "02",-->
  <!--    "মার্চ": "03",-->
  <!--    "এপ্রিল": "04",-->
  <!--    "মে": "05",-->
  <!--    "জুন": "06",-->
  <!--    "জুলাই": "07",-->
  <!--    "আগস্ট": "08",-->
  <!--    "সেপ্টেম্বর": "09",-->
  <!--    "অক্টোবর": "10",-->
  <!--    "নভেম্বর": "11",-->
  <!--    "ডিসেম্বর": "12"-->

      "January": "01",
      "February": "02",
      "March": "03",
      "April": "04",
      "May": "05",
      "June": "06",
      "July": "07",
      "August": "08",
      "September": "09",
      "October": "10",
      "November": "11",
      "December": "12"
    }

    for (let key in monthData) {
      let option = document.createElement("option");
      option.setAttribute('value', monthData[key]);
      let optionText = document.createTextNode(key);
      option.appendChild(optionText);
      monthDropDown.appendChild(option);
    }

    for (let key in monthData) {
      let option = document.createElement("option");
      option.setAttribute('value', monthData[key]);
      let optionText = document.createTextNode(key);
      option.appendChild(optionText);
      monthDropDownDead.appendChild(option);
    }

    const dayDropDown = document.getElementById("BurieddayFilter");
    const dayDropDownDead = document.getElementById("DeaddayFilter");
    for (let i=1; i<31; i++) {
      if(i<10){
        i = "0" + i;
      }
      let option = document.createElement("option");
      option.setAttribute('value', i);
      let optionText = document.createTextNode(i);
      option.appendChild(optionText);
      dayDropDown.appendChild(option);
    }

    for (let i=1; i<31; i++) {
      if(i<10){
        i = "0" + i;
      }
      let option = document.createElement("option");
      option.setAttribute('value', i);
      let optionText = document.createTextNode(i);
      option.appendChild(optionText);
      dayDropDownDead.appendChild(option);
    }

    const yearDropDown = document.getElementById("BuriedyearFilter");
    const yearDropDownDead = document.getElementById("DeadyearFilter");
    for (let i=1974; i<2024; i++) {
      let option = document.createElement("option");
      option.setAttribute('value', i);
      let optionText = document.createTextNode(i);
      option.appendChild(optionText);
      yearDropDown.appendChild(option);
    }

    for (let i=1974; i<2024; i++) {
      let option = document.createElement("option");
      option.setAttribute('value', i);
      let optionText = document.createTextNode(i);
      option.appendChild(optionText);
      yearDropDownDead.appendChild(option);
    }
  </script>





</body>


</html>